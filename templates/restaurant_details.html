{% extends 'base.html' %}

{% block title %}{{ restaurant.name }} - Details{% endblock %}

{% block body %}
  <div class="d-flex flex-row align-items-center">
    <div class="col-6">
      <h1>{{ restaurant.name }}</h1>
    </div>
    {% if "user" in session %}
      <div class="col-6 d-flex justify-content-end">
        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#favorites-modal">
          Favorite
        </button>
      </div>
    {% endif %}
  </div>

  {% if "user" in session %}
    <div class="modal fade" id="favorites-modal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Save to a Favorites List</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            {% if user.favorites_lists %}
              <p>Choose one of your Favorites lists to save to:</p>
              <form>
                <select id="favorite-list" class="form-select mb-4">
                  <option selected>Choose a list...</option>
                  {% for list in user.favorites_lists %}
                    <option value="{{ list.list_id }}">{{ list.name }}</option>
                  {% endfor %}
                </select>
                <div class="modal-footer">
                  <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Cancel</button>
                  <button type="button" class="btn btn-primary" id="save" value="{{ restaurant.restaurant_id }}">
                    Save
                  </button>
                </div>
              </form>
            {% else %}
              <p>You do not have any Favorites lists yet.</p>
              <a href="/users/{{ user.user_id }}">
                Go to your profile to create one.
              </a>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  {% endif %}
  
  <div class="row">
    <input type="text" class="rating mb-2" data-display-only="true" data-show-clear="false" data-show-caption="false" data-size="xs" value="{{ restaurant.rating }}">
    <div class="col-4">
      <div class="card">
        <div class="card-header">Address</div>
        <div class="card-body">
          <a class="link-underline link-underline-opacity-0 link-underline-opacity-75-hover" href="/map/{{ restaurant.restaurant_id}}">Get directions</a>
          <p class="mb-0">
            {{ restaurant.street_address }}
          </p>
          <p>
            {{ restaurant.city }}, {{ restaurant.state }} {{ restaurant.zipcode }}
          </p>
        
          {% if restaurant.phone_number %}
            <p>
              Phone Number: {{ restaurant.phone_number }}
            </p>
          {% endif %}
        </div>
      </div>
    </div>
    
    {% if restaurant.business_hours %}
      <h3>Business Hours</h3>
  
      <ul>
          {% for item in restaurant.business_hours %}
            <li>  
            <p>{{ item["day"] }}</p>
            {% if item["hours"] %} 
              {% for hours in item["hours"] %}
                <p>{{ hours }}</p>
              {% endfor %}
            {% else %}
              <p>Closed</p>
            {% endif %}
            </li>
          {% endfor %}   
      </ul>
    {% endif %}
  </div>
  
  <div class="row">
    <h2>{{ restaurant.name }} - Images</h2>
  </div>
  
  <div class="d-flex flex-row">
    {% for image in images %}
      <div class="col">
        <img class="img-responsive img-thumbnail" src="{{ image.img_url }}">
      </div> 
    {% endfor %}
  </div>

  <div class="row">
    <h2>{{ restaurant.name }} - Yelp Reviews</h2>
  </div>
  
  <div class="row">
    <div class="col-12">
      <ul>
        {% for yelp_review in yelp_reviews %}
          <li class="mb-3">
            <p>{{ yelp_review.reviewer_name }}</p>
            <div class="d-flex">
              <input type="text" class="rating" data-display-only="true" data-show-clear="false" data-show-caption="false" data-size="xs" value="{{ yelp_review.rating }}">
              <p>
                {{ yelp_review.created_at.month }}/{{ yelp_review.created_at.day }}/{{ yelp_review.created_at.year }}
              </p>
            </div>
            <p class="mb-0">
              {{ yelp_review.body }}
            </p>
            <a href="{{ yelp_review.review_url }}" target="_blank" rel="noopener noreferrer">
              See more
            </a>
          </li>
        {% endfor %}
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-12">
      <h2>{{ restaurant.name }} - User Reviews</h2>
      {% if "user" in session %}
        <form action="/write-review">
          <button type="submit" class="btn btn-primary" name="restaurant" value="{{ restaurant.restaurant_id }}">Leave a Review</button>
        </form>
      {% endif %}
    </div>
    <div class="col-12">
      <ul>
        {% for user_review in user_reviews %}
        <li class="mb-3">
          <p>{{ user_review.user.fname }} {{ user_review.user.lname[0] }}.</p>
          <div class="d-flex">
            <input type="text" class="rating" data-display-only="true" data-show-clear="false" data-show-caption="false" data-size="xs" value="{{ user_review.rating }}">
            <p>
              {{ user_review.created_at.month }}/{{ user_review.created_at.day }}/{{ user_review.created_at.year }}
            </p>
          </div>
          <p>
            {{ user_review.body }}
          </p>
          {% if "user" in session and user.user_id == user_review.user_id %}
            <button id="delete-review-btn" name="delete" type="button" class="btn btn-danger" value="{{ user_review.user_review_id }}">Remove Review</button>
          {% endif %}
        </li>
        {% endfor %}
      </ul>
    </div>
  </div>
{% endblock %}

{% block after_body %}
  <script src="/static/js/favorite.js"></script>
  <script src="/static/js/review.js"></script>
{% endblock %}